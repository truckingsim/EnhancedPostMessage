/*! EnhancedPostMessage 2014-09-30 */
!function(a){var b=!1,c={_defaults:{stringify:!1},_options:{},_events:{},_listeners:{},_sources:{},initialize:function(c){var f=this;if(!b){c.sources||this.log("Must have at least one source available",!0);for(var g in c.sources)c.sources.hasOwnProperty(g)&&this._addSource(g,c.sources[g]);if(c.events&&e(c.events).length)for(var h in c.events)c.events.hasOwnProperty(h)&&this._addEvent(h,c.events[h]);if(c.listeners&&e(c.listeners).length)for(var i in c.listeners)c.listeners.hasOwnProperty(i)&&this._addListener(i,c.listeners[i]);this._options=d({},this._defaults,c),a.addEventListener("message",function(a){f._handleEventListener(a)}),b=!0}},triggerEvent:function(b,c,d){var e,f,g={};if(e="parent"===b?a.parent:this._sources[b].contentWindow,f=this._events[c],!e)return this.log("No source by that name"),!1;if(!f)return this.log("No events by that name"),!1;if(f!==!0)if("function"==typeof f)d=f(d);else{if("object"!=typeof f)return this.log("Event value was not a valid type"),!1;d=f}g={eventName:c,data:d},e.postMessage(this._options.stringify?JSON.stringify(g):g,"*")},_addEvent:function(a,b){this._events[a]=b},_addListener:function(a,b){this._listeners[a]=b},_addSource:function(a,b){this._sources[a]=b},_setOptions:function(){},_setOption:function(a,b){this._options[a]=b},_handleEventListener:function(a){this._options.stringify&&"string"==typeof a.data&&(a.data=JSON.parse(a.data)),this._listeners[a.data.eventName]&&this._listeners[a.data.eventName](a.data.data)}};c.log=function(b,c){b=b instanceof Array?b:[b],a.console&&this._options.debug&&(c?console.error:console.log).apply(console,b)};var d=function(a){for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},e=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},f=function(a){arguments.length>1?"trigger"===arguments[0]&&arguments.length>=3&&c.triggerEvent(arguments[1],arguments[2],arguments[3]):1==arguments.length&&c.initialize(a)};f.prototype.trigger=function(){arguments.length>=2?c.triggerEvent(arguments[0],arguments[1],arguments[2]):c.log("Invalid trigger, need both an event name and a source name",!0)},a.EnhancedPostMessage=new f}(window);